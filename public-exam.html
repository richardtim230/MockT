<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Practice CBT Exams | Available Public Exam Listings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      background: linear-gradient(135deg, #2e1065 0%, #3b82f6 140%);
      min-height: 100vh;
    }
    .hero-bg {
      background: linear-gradient(125deg,rgba(37,99,235,.80) 65%,rgba(68,56,202,.60) 100%),
        url('https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=900&q=80') center center/cover no-repeat;
      min-height:310px;
      box-shadow: 0 6px 40px 0 rgba(30,41,59,0.18);
      position: relative;
      z-index: 0;
    }
    .hero-overlay {
      background: linear-gradient(135deg,rgba(30,41,59,0.29) 40%,rgba(30,64,175,0.08) 100%);
      position: absolute;
      inset: 0;
      border-radius: 0 0 2.7em 2.7em;
      z-index: 1;
    }
    .hero-content {
      position: relative;
      z-index: 2;
    }
    .glass {
      background: rgba(255,255,255,0.90);
      box-shadow: 0 8px 32px 0 rgba(37,99,235,0.12), 0 6px 18px 0 rgba(68,99,235,0.10);
      border-radius: 2em;
      border: 1.5px solid rgba(56,116,255,0.13);
      transition: transform .13s cubic-bezier(.4,0,.2,1), box-shadow .10s;
      overflow: hidden;
      min-height: 310px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      margin-bottom: 0.1rem;
      padding: 0;
    }
    .glass:hover {
      transform: scale(1.017) translateY(-1.5px);
      box-shadow: 0 16px 38px 0 rgba(37,99,235,0.13), 0 3px 18px 0 rgba(68,99,235,0.15);
    }
    .exam-thumb {
      width: 100%; 
      height: 130px;
      object-fit: cover; 
      object-position: center;
      transition: filter .2s;
      z-index:1;
      border-top-left-radius: 2em;
      border-top-right-radius: 2em;
    }
    @media (max-width: 680px){
      .exam-thumb { height: 90px; }
      .glass { min-height: 230px;}
    }
    .info-bar {
      margin-top: -.5em;
      margin-bottom: .4em;
      display: flex;
      flex-wrap: wrap;
      gap: .6em;
      align-items: center;
    }
    .subject-badge {
      background: #2563eb;
      color: #fff;
      font-size: 0.97em;
      border-radius: .9em;
      padding: .32em 1em .32em .82em;
      font-weight: bold;
      min-width: 96px;
      display: flex;
      align-items: center;
      gap: .32em;
    }
    .code-badge {
      background: #f1f5f9;
      color:#1e40af;
      font-size: 0.98em;
      border-radius: .9em;
      padding: .32em 1.1em .32em 1.1em;
      font-weight: 600;
    }
    .exam-title {
      font-size: 1.15rem;
      color: #1e293b;
      font-weight: bold;
      margin-bottom: .47em;
      margin-top: .04em;
      letter-spacing: 0.01em;
    }
    .exam-meta-list {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 1.2em;
      margin-bottom:.27em;
    }
    .meta-item {
      display: flex;
      align-items: center;
      font-size: 1.01em;
      color: #1e3a8a;
      gap: .27em;
      font-weight: 600;
      min-width: 92px;
      white-space: nowrap;
    }
    .practice-btn {
      background: linear-gradient(90deg,#1e40af 80%,#2563eb 100%);
      border-radius: 1.3em;
      min-height:2.7em;
      font-weight: bold;
      font-size: 1em;
      color: #fff;
      letter-spacing:.01em;
      width: 93%;
      box-shadow: 0 4px 24px #3b82f62f;
      margin: 0.8em auto 0.75em auto;
      transition: background .13s, transform .09s, box-shadow .12s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.41em;
    }
    .practice-btn:hover, .practice-btn:focus {
      background:linear-gradient(90deg,#1d4ed8 90%,#818cf8 100%);
      box-shadow: 0 6px 19px #60a5fa33;
      transform: scale(1.022);
    }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col items-center bg-gradient-to-br from-blue-900 via-blue-700 to-indigo-900 px-0 py-0 select-none">
  <!-- ========= HERO SECTION ========== -->
  <section class="hero-bg w-full max-w-5xl mx-auto rounded-b-3xl shadow-2xl mb-6 lg:rounded-b-[46px] border-b-4 border-blue-900 relative overflow-hidden">
    <div class="hero-overlay"></div>
    <div class="hero-content relative z-10 px-6 sm:px-12 pt-10 pb-12 text-center flex flex-col items-center justify-center">
      <h1 class="max-w-3xl text-3xl sm:text-4xl md:text-5xl font-extrabold text-white tracking-tight drop-shadow-[0_2px_10px_rgba(79,70,229,.35)] mb-2">
        <i class="fa-solid fa-graduation-cap text-2xl md:text-3xl text-yellow-300 mr-2 animate-bounce"></i>
        <span class="bg-gradient-to-r from-yellow-400 via-blue-100 to-white bg-clip-text text-transparent">Practice CBT Exams</span>
      </h1>
      <div class="max-w-xl mx-auto">
        <p class="text-blue-100/90 text-lg md:text-xl font-medium mb-2 sm:mb-1 px-2" style="text-shadow: 0 1px 7px #2226;">
          Browse and practice full-featured computer-based test (CBT) exams for a wide range of university courses.<br>
          <span class="inline-block bg-white text-blue-900 px-3 py-1 rounded-xl mt-2 font-bold text-sm shadow">Kick-start your revision journey today!</span>
        </p>
      </div>
      <div class="flex justify-center gap-3 mt-5">
        <a href="#exams-list"
          class="inline-flex gap-2 px-7 py-3 bg-yellow-400/95 rounded-xl font-extrabold text-blue-900 shadow-lg text-lg hover:bg-yellow-300 hover:scale-105 transition-all border-none focus:ring-2 focus:ring-blue-400">
          <i class="fa fa-list-alt"></i>View Exams
        </a>
        <a href="access.html"
          class="inline-flex gap-2 px-5 py-3 bg-white/90 rounded-xl text-blue-700 font-bold shadow text-lg hover:bg-white hover:scale-105 border-none transition-all">
          <i class="fas fa-sign-in-alt"></i> Exam Access
        </a>
      </div>
      <div class="flex justify-center mt-8">
        <span class="inline-flex items-center gap-2 py-1 px-3 rounded-full bg-blue-200 shadow text-blue-900 text-xs md:text-sm font-semibold">
          <i class="fa fa-users"></i> Join 1,000+ students on D-Rich CBT!
        </span>
      </div>
    </div>
  </section>

  <main class="w-full max-w-6xl px-2 pb-14 mx-auto">
    <h2 class="mb-6 text-2xl sm:text-3xl font-bold text-white tracking-wider text-center font-[system-ui]">
      <span class="inline-block bg-gradient-to-tr from-yellow-300 via-blue-200 to-indigo-400 bg-clip-text text-transparent drop-shadow-[0_2px_5px_rgba(0,0,0,.18)] px-1">
        Available Practice Exams
      </span>
    </h2>
    <!-- Exam cards container -->
    <section id="exams-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-7"></section>
    <div class="flex justify-center mt-7">
      <button id="reload-btn" class="hidden py-2 px-8 rounded-2xl bg-blue-700 text-white font-bold text-lg shadow hover:bg-blue-900 transition-all">
        <i class="fa fa-refresh animate-spin mr-2"></i> Reload Exams
      </button>
    </div>
    <div id="status-message" class="mt-12 text-center text-blue-100 text-xl font-semibold"></div>
  </main>

  <footer class="w-full max-w-4xl mx-auto py-8 flex flex-col sm:flex-row items-center justify-between mt-10 text-blue-100 bg-blue-900 bg-opacity-95 text-xs sm:text-sm rounded-2xl shadow-xl border-t-4 border-indigo-900">
    <div>
      <b>D-Rich CBT &copy; <span id="year"></span></b>
      <span class="ml-3 hidden sm:inline text-blue-300">|</span>
      <span class="ml-2 text-blue-400">For best experience, use Chrome or Edge.</span>
    </div>
    <a href="access.html" class="mt-3 sm:mt-0 px-5 py-2 rounded-2xl bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold shadow transition"><i class="fas fa-sign-in-alt mr-1"></i>Exam Access Page</a>
  </footer>

  <script>
    // ========== CONFIG ==========
    const API_BASE = "https://examguide.onrender.com";
    const accessPage = "access.html";
    // Single image for all cards (feel free to swap for any image URL as needed)
    const cardImage = "https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=900&q=80";

    // ========== DOMS ==========
    const examsList = document.getElementById('exams-list');
    const statusMsg = document.getElementById('status-message');
    const reloadBtn = document.getElementById('reload-btn');

    // ========== UTILITY ==========
    function formatDuration(secs) {
      if (!secs || isNaN(secs)) return "--";
      const h = Math.floor(secs / 3600);
      const m = Math.floor((secs % 3600) / 60);
      return [h > 0 ? (h + 'h') : "", m > 0 ? (m + 'm') : ""].filter(Boolean).join(' ') || '1h';
    }

    // ========== FETCH & DISPLAY ==========
    async function fetchExams() {
      examsList.innerHTML = "";
      statusMsg.textContent = "Loading available exams...";
      reloadBtn.classList.add("hidden");
      try {
        const res = await fetch(`${API_BASE}/api/exam-set`);
        if (!res.ok) throw new Error();
        const data = await res.json();
        if (!Array.isArray(data) || data.length === 0) {
          statusMsg.textContent = "No public exams are currently available. Please check back later.";
          reloadBtn.classList.remove("hidden");
          return;
        }
        // Sort exams by recent first (uses createdAt descending in backend)
        data.forEach((exam, idx) => {
          examsList.appendChild(renderExamCard(exam, idx));
        });
        statusMsg.textContent = "";
      } catch (e) {
        statusMsg.textContent = "Could not fetch exams. Please try again.";
        reloadBtn.classList.remove("hidden");
      }
    }

    // ========== CARD UI ==========
    function renderExamCard(exam, idx = 0) {
      // Escape HTML utility
      function esc(str) { return String(str || '').replace(/[&<>"']/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[s])); }
      // Icon selection
      const icons = {
        mth: "fa-square-root-variable",
        chm: "fa-flask-vial",
        bio: "fa-leaf",
        phy: "fa-atom",
        eng: "fa-pen-fancy",
        lit: "fa-book-open",
        eco: "fa-chart-line",
        geo: "fa-globe-africa",
        gov: "fa-landmark",
        crs: "fa-bible",
        default: "fa-file-alt"
      };
      let subj = (exam.subject || '').toLowerCase();
      let icon = Object.keys(icons).find(k => subj.startsWith(k)) ? icons[subj.substr(0, 3)] : icons.default;

      const title = exam.title || exam.subject || "Untitled Exam";
      const examCode = exam.accessCode || "";
      // Card markup
      const card = document.createElement('div');
      card.className = `glass group shadow-lg relative`;
      card.innerHTML = `
        <img src="${cardImage}" alt="Exam Subject" class="exam-thumb relative z-10" loading="lazy" />
        <div class="flex-1 pt-2 px-5 pb-2 relative z-20 flex flex-col">
          <div class="info-bar">
            <span class="subject-badge mb-0"><i class="fa ${icon}"></i>&nbsp;${esc(exam.subject)}</span>
            <span class="code-badge mb-0">${esc(exam.accessCode)}</span>
          </div>
          <div class="exam-title mb-1">${esc(title)}</div>
          <div class="exam-meta-list mb-1">
            <span class="meta-item"><i class="fa fa-clock mr-1"></i> ${formatDuration(exam.duration)}</span>
            <span class="meta-item"><i class="fa fa-list-ol mr-1"></i> <span class="question-count-ct">--</span> Questions</span>
          </div>
          <div class="meta-item mt-0 mb-0 text-[0.97em]"><i class="fa fa-calendar-alt mr-1"></i> ${exam.createdAt ? (new Date(exam.createdAt).toLocaleDateString()) : "--"}</div>
        </div>
        <div class="flex-1 flex flex-col justify-end">
          <button type="button"
            class="practice-btn mb-0"
            data-code="${esc(exam.accessCode)}"
          >
            <i class="fa fa-play-circle mr-1"></i> Practice Now
          </button>
        </div>
      `;
      // Fetch number of questions for this exam set
      fetchExamQuestionCount(exam._id, card.querySelector('.question-count-ct'));
      // On button: open access.html and prefill
      card.querySelector('.practice-btn').onclick = () => {
        window.location.href = `${accessPage}?examCode=${encodeURIComponent(examCode)}`;
      };
      return card;
    }

    // Fetch question count for richer UI (optional)
    async function fetchExamQuestionCount(examSetId, el) {
      if (!examSetId || !el) return;
      try {
        const all = await fetch(`${API_BASE}/api/cbt-questions?examSet=${encodeURIComponent(examSetId)}&limit=1000`);
        const data = await all.json();
        el.textContent = Array.isArray(data) ? data.length : "--";
      } catch { el.textContent = "--"; }
    }

    reloadBtn.onclick = fetchExams;

    // Auto-fill year
    document.getElementById('year').textContent = (new Date()).getFullYear();

    // ========== RUN ==========
    fetchExams();
  </script>
</body>
</html>
