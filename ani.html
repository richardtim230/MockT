<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Script-Aligned Animation Platform</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet"/>
  <style>
    .fade-in { animation: fadeIn 0.6s; }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.97);}
      to { opacity: 1; transform: scale(1);}
    }
    .slide-indicator-dot {
      width: .75rem; height:.75rem; border-radius:9999px; background:#ddd; margin-right:.25rem; display:inline-block;
    }
    .slide-indicator-dot.active { background: #2563eb; }
    .css-loader { border-top-color: #2563eb; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-blue-700 shadow text-white py-4">
    <div class="container mx-auto px-4 flex flex-wrap gap-2 justify-between items-center">
      <h1 class="text-2xl font-bold">Script Animator Pro&nbsp;<span class="text-sm font-normal text-blue-200">BETA</span></h1>
      <span class="text-xs opacity-70">by @YourCompany</span>
    </div>
  </header>
  <main class="container mx-auto flex-1 p-4">
    <!-- Uploader, Settings -->
    <form id="upload-form" class="bg-white rounded-lg shadow-lg max-w-2xl mx-auto p-6 mt-8 space-y-6">
      <div>
        <label class="block font-medium mb-1">üì¶ Upload Images/Videos (Ordered)</label>
        <div id="dropzone" class="border-2 border-dashed border-blue-400 w-full rounded-lg bg-blue-50 py-6 text-center cursor-pointer hover:bg-blue-100 focus:outline-none focus:ring" tabindex="0">
          <span id="drop-hint" class="text-blue-800 text-sm">Drag & drop files or click to select</span>
          <input type="file" id="images-input" accept="image/*,video/*" multiple required class="hidden"/>
        </div>
        <div id="file-thumb-list" class="flex gap-4 mt-2 flex-wrap"></div>
        <small class="block text-gray-500 mt-1">Supported: png, jpg, webp, mp4, etc.</small>
      </div>
      <div>
        <label class="block mb-1 font-medium">üí¨ Script file (txt format, 1 line = 1 slide)</label>
        <input type="file" id="script-input" accept=".txt" required class="block w-full border border-gray-300 rounded px-2 py-1"/>
        <small class="text-gray-500">Each line must match the media order.</small>
      </div>
      <div>
        <label class="block mb-1 font-medium">üéôÔ∏è Voice Over (Optional, mp3/wav):</label>
        <input type="file" id="audio-input" accept="audio/*" class="block w-full border border-gray-300 rounded px-2 py-1"/>
      </div>
      <div>
        <label class="block mb-1 font-medium">‚è±Ô∏è Default per-slide duration (Sec):</label>
        <input type="number" id="duration-input" class="border border-gray-300 rounded px-2 w-24" min="1" max="60" step="0.1" value="2.5">
        <span class="text-xs text-gray-400 ml-2">Can edit per-slide later!</span>
      </div>
      <div id="upload-warning" class="mt-2 text-sm text-red-600 hidden"></div>
      <button type="submit" class="btn-primary block w-full py-2 text-lg font-semibold">üé¨ Start Animation Studio</button>
    </form>

    <!-- SLIDE EDITOR & PREVIEW -->
    <div id="anim-area" class="hidden mt-10">
      <!-- Slide Timeline/Progress -->
      <div class="flex items-center justify-between mb-4">
        <div>
          <button id="prev-btn" class="btn-secondary mr-2" title="Previous slide">&larr;</button>
          <button id="next-btn" class="btn-secondary" title="Next slide">&rarr;</button>
          <span id="slide-idx-label" class="ml-4 text-base font-semibold text-blue-700"></span>
        </div>
        <div id="slide-indicator" class="flex items-center justify-end flex-wrap"></div>
      </div>
      <div class="flex flex-col md:flex-row gap-8">
        <!-- Preview Media -->
        <div class="relative">
          <img id="display-image" src="" class="w-72 h-72 object-contain rounded shadow hidden transition" alt="Slide Image"/>
          <video id="display-video" class="w-72 h-72 object-contain rounded shadow hidden transition" controls></video>
          <!-- Loader spinner -->
          <div id="preview-loader" class="absolute inset-0 flex items-center justify-center hidden">
            <div class="w-12 h-12 border-4 border-blue-100 rounded-full css-loader"></div>
          </div>
        </div>
        <!-- Slide Text & Controls -->
        <div class="flex-1 min-w-[220px]">
          <label for="slide-script" class="block font-medium">Slide Script</label>
          <textarea id="slide-script" class="w-full h-24 p-2 border border-gray-300 rounded mb-4" rows="3"></textarea>
          <div class="flex gap-4 items-end mb-4">
            <div>
              <label class="text-xs font-semibold mb-1 block">Duration (s)</label>
              <input id="slide-duration" type="number" min="1" max="60" step="0.1" class="border border-gray-300 rounded px-2 w-20"/>
            </div>
            <div>
              <label class="text-xs font-semibold mb-1 block">Transition</label>
              <select id="slide-transition" class="border border-gray-300 rounded px-1 w-28">
                <option value="fade">Fade</option>
                <option value="slide">Slide</option>
                <option value="none">None</option>
              </select>
            </div>
          </div>
          <audio id="voiceover" controls class="mb-4 w-full hidden"></audio>
          <div class="flex gap-3 items-center mb-4">
            <button class="btn-primary" id="play-btn">‚ñ∂Ô∏è Play All</button>
            <button class="btn-secondary" id="stop-btn" type="button">‚èπÔ∏è Stop</button>
            <span id="playing-indicator" class="ml-3 text-blue-600 hidden">Playing...</span>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="text-center text-xs mt-10 mb-2 text-gray-400">¬© 2026 Script Animator Pro ‚Äî MIT License</footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
  <script>
    // Elements
    const dropzone = document.getElementById('dropzone');
    const imageInput = document.getElementById('images-input');
    const scriptInput = document.getElementById('script-input');
    const audioInput = document.getElementById('audio-input');
    const durationInput = document.getElementById('duration-input');
    const thumbList = document.getElementById('file-thumb-list');
    const form = document.getElementById('upload-form');
    const warning = document.getElementById('upload-warning');
    const animArea = document.getElementById('anim-area');
    const displayImg = document.getElementById('display-image');
    const displayVideo = document.getElementById('display-video');
    const previewLoader = document.getElementById('preview-loader');
    const voiceover = document.getElementById('voiceover');
    const playBtn = document.getElementById('play-btn');
    const stopBtn = document.getElementById('stop-btn');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const slideScript = document.getElementById('slide-script');
    const slideDuration = document.getElementById('slide-duration');
    const slideTransition = document.getElementById('slide-transition');
    const slideIndicator = document.getElementById('slide-indicator');
    const slideIdxLabel = document.getElementById('slide-idx-label');
    const playingIndicator = document.getElementById('playing-indicator');

    // App State
    let slides = [];
    let audioUrl = "";
    let current = 0;
    let autoPlaying = false;
    let audioElement = null;
    let autoAdvanceInterval = null;

    // --- Drag & drop logic ---
    dropzone.addEventListener('click', ()=> imageInput.click());
    dropzone.addEventListener('keydown', e => { if(e.key===" "||e.key==="Enter") imageInput.click(); });
    dropzone.addEventListener('dragover', e=>{e.preventDefault(); dropzone.classList.add('bg-blue-200');});
    dropzone.addEventListener('dragleave', e=>{e.preventDefault(); dropzone.classList.remove('bg-blue-200');});
    dropzone.addEventListener('drop', (e)=>{
      e.preventDefault();
      dropzone.classList.remove('bg-blue-200');
      imageInput.files = e.dataTransfer.files;
      showThumbs(imageInput.files);
    });
    imageInput.addEventListener('change', ()=> showThumbs(imageInput.files));
    function showThumbs(files) {
      thumbList.innerHTML = '';
      Array.from(files).forEach(f=>{
        const type = f.type.startsWith('video') ? 'video' : 'image';
        const url = URL.createObjectURL(f);
        let el = document.createElement(type==='image'?'img':'video');
        el.src = url; el.setAttribute('class', 'rounded shadow w-14 h-14 object-cover mr-1');
        el.setAttribute('title', f.name);
        el.setAttribute('tabindex','-1');
        if(type==="video") el.muted = true, el.loop=true, el.play();
        thumbList.appendChild(el);
      });
    }

    // --- Form upload/validation ---
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      warning.classList.add('hidden');
      slides = [];
      const files = Array.from(imageInput.files);
      if(!files.length){ showWarn('Please select images or videos.'); return; }
      let scriptLines = [];
      if (!scriptInput.files.length) { showWarn('Script is required.'); return; }
      try {
        scriptLines = (await scriptInput.files[0].text())
          .split('\n').map(s=>s.trim()).filter(Boolean);
      } catch {
        showWarn("Error reading script file.");
        return;
      }
      if(files.length !== scriptLines.length) {
        showWarn(`Slides (${files.length}) and script lines (${scriptLines.length}) count mismatch.`);
        return;
      }
      let defaultDur = Number(durationInput.value) || 2.5;
      slides = files.map((file,i)=>{
        const type = file.type.startsWith("video")? "video":"image";
        return {
          type, file, url:URL.createObjectURL(file),
          script: scriptLines[i],
          duration: defaultDur,
          transition:"fade"
        };
      });
      // Audio
      if(audioInput.files.length){
        audioUrl = URL.createObjectURL(audioInput.files[0]);
        voiceover.src = audioUrl;
        voiceover.classList.remove('hidden');
      } else {
        audioUrl = "";
        voiceover.classList.add('hidden');
      }
      animArea.classList.remove('hidden');
      current = 0;
      renderSlide();
      renderIndicator();
      stopAutoPlay();
    });

    function showWarn(msg){
      warning.textContent = msg;
      warning.classList.remove('hidden');
    }

    // --- Slide Navigation, Editing ---
    function renderSlide(){
      const s = slides[current];
      previewLoader.classList.remove('hidden');
      // Hide both first
      displayImg.classList.add('hidden');
      displayVideo.classList.add('hidden');
      setTimeout(()=>{ // Give time for spinner to show visually before heavy load.
        if(s.type==="image"){
          displayImg.src = s.url;
          displayImg.classList.remove('hidden','fade-in');
          void displayImg.offsetWidth; displayImg.classList.add('fade-in');
          displayVideo.pause(); displayVideo.currentTime = 0;
        } else {
          displayVideo.src = s.url;
          displayVideo.classList.remove('hidden','fade-in');
          void displayVideo.offsetWidth; displayVideo.classList.add('fade-in');
          displayImg.src=""; displayImg.classList.add('hidden');
        }
        slideScript.value = s.script;
        slideDuration.value = s.duration;
        slideTransition.value = s.transition;
        slideIdxLabel.textContent = `Slide ${current+1} / ${slides.length}`;
        previewLoader.classList.add('hidden');
      },200);
    }
    function renderIndicator(){
      slideIndicator.innerHTML = "";
      for(let i=0;i<slides.length;++i) {
        const dot = document.createElement('span');
        dot.className='slide-indicator-dot'+(i===current?' active':'');
        dot.setAttribute('tabindex','0');
        dot.setAttribute('title','Jump to slide '+(i+1));
        dot.onclick = ()=>{ current = i; renderSlide(); renderIndicator(); };
        dot.onkeydown = e=>{ if(e.key===" "||e.key==="Enter") { current = i; renderSlide(); renderIndicator(); } };
        slideIndicator.appendChild(dot);
      }
    }
    nextBtn.onclick = ()=>{
      if(current < slides.length-1) { current++;renderSlide();renderIndicator();}
    };
    prevBtn.onclick = ()=>{
      if(current > 0) { current--;renderSlide();renderIndicator();}
    };
    slideScript.addEventListener('blur', ()=>{ slides[current].script=slideScript.value; });
    slideDuration.addEventListener('blur', ()=>{ slides[current].duration=Number(slideDuration.value)||2.5; });
    slideTransition.addEventListener('change', ()=>{ slides[current].transition=slideTransition.value; });

    // --- Player ---
    playBtn.onclick = ()=>{
      if(autoPlaying){ stopAutoPlay(); return;}
      autoPlaying = true; playBtn.textContent="‚è∏Ô∏è Pause"; playingIndicator.classList.remove('hidden');
      if(audioUrl) autoPlayWithVoiceOver();
      else autoPlayScript();
    };
    stopBtn.onclick = ()=> stopAutoPlay();
    function autoPlayScript(){
      current=0;
      renderSlide();renderIndicator();
      function advance(){
        if(!autoPlaying) return;
        if(current<slides.length-1) {
          setTimeout(()=>{
            if(!autoPlaying) return;
            current++; renderSlide();renderIndicator(); advance();
          }, (slides[current].duration||2.5)*1000);
        } else {
          setTimeout(stopAutoPlay, (slides[current].duration||2.5)*1000);
        }
      }
      advance();
    }
    function stopAutoPlay(){
      autoPlaying = false; playBtn.textContent="‚ñ∂Ô∏è Play All"; playingIndicator.classList.add('hidden');
      if(autoAdvanceInterval) clearInterval(autoAdvanceInterval);
      if(audioElement) { audioElement.pause(); audioElement = null;}
      displayVideo.pause(); displayVideo.currentTime=0;
    }
    function autoPlayWithVoiceOver(){
      // Play voiceover, segment slides by chunks of total duration.
      audioElement = new Audio(audioUrl);
      audioElement.onloadedmetadata = ()=>{
        const total = audioElement.duration, unit = total/slides.length;
        let idx = 0; current=idx;renderSlide();renderIndicator();
        audioElement.play();
        autoAdvanceInterval = setInterval(()=>{
          if(!autoPlaying) { stopAutoPlay(); return;}
          idx++;
          if(idx<slides.length) { current=idx; renderSlide();renderIndicator(); }
          else { clearInterval(autoAdvanceInterval); }
        }, unit*1000);
        audioElement.onended = stopAutoPlay;
      };
      audioElement.onerror = ()=>{ stopAutoPlay(); showWarn('Audio file error.');};
    }

    // Keyboard navigation for accessibility
    document.addEventListener('keydown', (e)=>{
      if(animArea.classList.contains('hidden')) return;
      if(e.target.tagName==='TEXTAREA' || e.target.tagName==='INPUT') return;
      if(e.key==="ArrowRight") nextBtn.click();
      if(e.key==="ArrowLeft") prevBtn.click();
    });
  </script>
</body>
</html>
